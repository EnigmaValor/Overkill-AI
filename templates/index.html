<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Magic AI Builder</title>
    <link rel="stylesheet" href="/static/css/styles.css" />
  </head>
  <body>
    <header>
      <h1>ðŸª„ Magic AI Builder</h1>
      <p>Build and sign Android APKs from Gradle or Unity.</p>
    </header>

    <main>
      <section class="card">
        <h2>Gradle Android Build</h2>
        <form id="gradle-form">
          <label>Project directory
            <input name="project_dir" placeholder="/path/to/android/project" required />
          </label>
          <label>Variant
            <input name="variant" value="Release" />
          </label>
          <label>Extra Gradle args (space-separated)
            <input name="extra_args" placeholder="--no-daemon --stacktrace" />
          </label>
          <button type="submit">Build Gradle APK</button>
        </form>
        <pre id="gradle-result"></pre>
      </section>

      <section class="card">
        <h2>Unity Android Build</h2>
        <form id="unity-form">
          <label>Project directory
            <input name="project_dir" placeholder="/path/to/unity/project" required />
          </label>
          <label>Build method (C# static method)
            <input name="build_method" placeholder="BuildScripts.AndroidBuild.Build" required />
          </label>
          <label>Output name
            <input name="output_name" value="unity_build.apk" />
          </label>
          <label>Extra args
            <input name="extra_args" placeholder="-someFlag value" />
          </label>
          <button type="submit">Build Unity APK</button>
        </form>
        <pre id="unity-result"></pre>
      </section>

      <section class="card">
        <h2>AI Suggestions</h2>
        <button id="load-suggestions">Load suggestions</button>
        <ul id="suggestions"></ul>
      </section>

      <section class="card">
        <h2>Fun demo</h2>
        <p>Open a playful "Roblox AI" mock interface (visual only): <a href="/roblox-ai">Launch demo</a></p>
      </section>
    </main>

    <footer>
      <small>Config: <code id="config-info"></code></small>
    </footer>

    <script>
      window.__CONFIG__ = {{ config | tojson | safe }};
      async function postJSON(url, data) {
        const res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const body = await res.json();
        if (!res.ok) throw new Error(body.error || 'Request failed');
        return body;
      }

      document.getElementById('gradle-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        const extraArgs = (fd.get('extra_args') || '').toString().trim();
        const payload = {
          project_dir: fd.get('project_dir'),
          variant: fd.get('variant'),
          extra_args: extraArgs ? extraArgs.split(/\s+/) : []
        };
        const out = document.getElementById('gradle-result');
        out.textContent = 'Building...';
        try {
          const resp = await postJSON('/api/build/gradle', payload);
          out.textContent = JSON.stringify(resp, null, 2);
        } catch (err) {
          out.textContent = err.message;
        }
      });

      document.getElementById('unity-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        const extraArgs = (fd.get('extra_args') || '').toString().trim();
        const payload = {
          project_dir: fd.get('project_dir'),
          build_method: fd.get('build_method'),
          output_name: fd.get('output_name'),
          extra_args: extraArgs ? extraArgs.split(/\s+/) : []
        };
        const out = document.getElementById('unity-result');
        out.textContent = 'Building...';
        try {
          const resp = await postJSON('/api/build/unity', payload);
          out.textContent = JSON.stringify(resp, null, 2);
        } catch (err) {
          out.textContent = err.message;
        }
      });

      document.getElementById('load-suggestions').addEventListener('click', async () => {
        const res = await fetch('/api/ai/suggestions');
        const body = await res.json();
        const ul = document.getElementById('suggestions');
        ul.innerHTML = '';
        for (const s of body.suggestions) {
          const li = document.createElement('li');
          li.textContent = s;
          ul.appendChild(li);
        }
      });

      // show config
      fetch('/').then(()=>{});
      document.getElementById('config-info').textContent = JSON.stringify(window.__CONFIG__ || {}, null, 0);
    </script>
  </body>
</html>
